<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Emu.io</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; background: #0b0f1a; color: white; }
    canvas { display: block; }
    #mainMenu, #pauseMenu {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.8); display: flex; flex-direction: column; align-items: center; justify-content: center;
    }
    .menu-btn {
      background: #1d1f3a; border: none; color: white; padding: 12px 24px;
      margin: 10px; font-size: 20px; cursor: pointer; border-radius: 6px;
    }
    .menu-btn:hover { background: #2c2f50; }
    #healthBarContainer {
      position: absolute; top: 20px; left: 20px; width: 200px; height: 24px; background: #330000; border-radius: 6px;
    }
    #healthBar {
      height: 100%; width: 100%; background: red; border-radius: 6px;
    }
    #healthText {
      position: absolute; top: 0; left: 0; width: 100%; text-align: center; line-height: 24px;
      color: white; font-weight: bold;
    }
  </style>
</head>
<body>

<div id="mainMenu">
  <h1>üéØ Emu.io</h1>
  <p>Choose a map:</p>
  <button class="menu-btn mapBtn" data-map="0">Arena</button>
  <button class="menu-btn mapBtn" data-map="1">Maze</button>
  <button class="menu-btn mapBtn" data-map="2">Open Field</button>
</div>

<div id="pauseMenu" style="display: none;">
  <h2>‚è∏ Paused</h2>
  <button class="menu-btn" id="resumeBtn">Resume</button>
  <button class="menu-btn" id="mainMenuBtn">Main Menu</button>
</div>

<div id="healthBarContainer" style="display: none;">
  <div id="healthBar"></div>
  <div id="healthText">100</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/controls/PointerLockControls.js"></script>

<script>
(() => {
  let camera, scene, renderer, controls, player, clock, bullets = [], enemies = [], isPaused = true;
  let currentMapIndex = 0;
  let health = 100;

  const mainMenu = document.getElementById('mainMenu');
  const pauseMenu = document.getElementById('pauseMenu');
  const healthBar = document.getElementById('healthBar');
  const healthBarContainer = document.getElementById('healthBarContainer');
  const healthText = document.getElementById('healthText');

  const listener = new AudioListener();
  const shootSound = new Audio('https://freesound.org/data/previews/66/66717_931655-lq.mp3');
  const damageSound = new Audio('https://freesound.org/data/previews/341/341695_3248244-lq.mp3');
  const deathSound = new Audio('https://freesound.org/data/previews/84/84869_1022654-lq.mp3');

  function playSound(audioURL) {
    const audio = new Audio(audioURL);
    audio.volume = 0.4;
    audio.play();
  }

  function init() {
    clock = new THREE.Clock();
    scene = new THREE.Scene();

    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    player = camera;

    renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    controls = new THREE.PointerLockControls(camera, document.body);

    document.addEventListener('click', () => {
      if (!isPaused && controls) controls.lock();
    });

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5, 10, 7);
    scene.add(light);

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        pauseGame();
      }
    });

    animate();
  }

  function updateHealthUI() {
    healthBar.style.width = health + '%';
    healthText.textContent = health;
  }

  function takeDamage(amount) {
    health -= amount;
    if (health <= 0) {
      health = 0;
      updateHealthUI();
      playSound(deathSound.src);
      setTimeout(respawnPlayer, 2000);
    } else {
      playSound(damageSound.src);
      updateHealthUI();
    }
  }

  function respawnPlayer() {
    health = 100;
    updateHealthUI();
    player.position.set(0, 2, 0);
  }

  function shootBullet() {
    const bullet = new THREE.Mesh(
      new THREE.SphereGeometry(0.1, 8, 8),
      new THREE.MeshBasicMaterial({color: 0xffff00})
    );
    bullet.position.copy(player.position);
    const direction = new THREE.Vector3();
    camera.getWorldDirection(direction);
    bullet.userData.velocity = direction.multiplyScalar(0.5);
    bullets.push(bullet);
    scene.add(bullet);
    playSound(shootSound.src);
  }

  function createEnemy(x, z) {
    const enemy = new THREE.Mesh(
      new THREE.BoxGeometry(1, 2, 1),
      new THREE.MeshStandardMaterial({color: 0x772222})
    );
    enemy.position.set(x, 1, z);
    enemy.userData.health = 100;
    enemy.userData.lastShot = 0;
    enemies.push(enemy);
    scene.add(enemy);
  }

  function updateEnemies(delta) {
    enemies.forEach((enemy) => {
      const dir = new THREE.Vector3().subVectors(player.position, enemy.position);
      if (dir.length() > 1) {
        dir.normalize();
        enemy.position.add(dir.multiplyScalar(delta));
      }

      // Shoot randomly
      enemy.userData.lastShot += delta;
      if (enemy.userData.lastShot > 2 + Math.random() * 2) {
        enemy.userData.lastShot = 0;
        const bullet = new THREE.Mesh(
          new THREE.SphereGeometry(0.1, 8, 8),
          new THREE.MeshBasicMaterial({color: 0xff0000})
        );
        bullet.position.copy(enemy.position);
        const direction = new THREE.Vector3().subVectors(player.position, enemy.position).normalize();
        bullet.userData.velocity = direction.multiplyScalar(0.3);
        bullet.userData.isEnemy = true;
        bullets.push(bullet);
        scene.add(bullet);
        playSound(shootSound.src);
      }
    });
  }

  function updateBullets(delta) {
    bullets.forEach((bullet, i) => {
      bullet.position.add(bullet.userData.velocity);

      if (bullet.userData.isEnemy) {
        if (bullet.position.distanceTo(player.position) < 1) {
          takeDamage(10);
          scene.remove(bullet);
          bullets.splice(i, 1);
        }
      } else {
        enemies.forEach((enemy, j) => {
          if (bullet.position.distanceTo(enemy.position) < 1) {
            enemy.userData.health -= 25;
            if (enemy.userData.health <= 0) {
              scene.remove(enemy);
              enemies.splice(j, 1);
            }
            scene.remove(bullet);
            bullets.splice(i, 1);
          }
        });
      }
    });
  }

  function updatePlayerMovement(delta) {
    // WASD not implemented in this version for brevity
  }

  const maps = [
    () => { createEnemy(5, 5); createEnemy(-5, 5); createEnemy(5, -5); createEnemy(-5, -5); },
    () => { createEnemy(0, 0); createEnemy(-6, 4); createEnemy(6, -4); },
    () => { for (let i = 0; i < 5; i++) createEnemy((Math.random()-0.5)*30, (Math.random()-0.5)*30); }
  ];

  function clearMap() {
    enemies.forEach(e => scene.remove(e));
    bullets.forEach(b => scene.remove(b));
    enemies = [];
    bullets = [];
  }

  function startGame(mapIndex) {
    currentMapIndex = mapIndex;
    clearMap();
    respawnPlayer();
    maps[mapIndex]();
    if (controls && controls.lock) controls.lock();
    mainMenu.style.display = 'none';
    pauseMenu.style.display = 'none';
    healthBarContainer.style.display = 'block';
    isPaused = false;
  }

  function pauseGame() {
    isPaused = true;
    controls.unlock();
    pauseMenu.style.display = 'flex';
    healthBarContainer.style.display = 'none';
  }

  function resumeGame() {
    isPaused = false;
    controls.lock();
    pauseMenu.style.display = 'none';
    healthBarContainer.style.display = 'block';
  }

  function animate() {
    requestAnimationFrame(animate);
    if (!isPaused) {
      const delta = clock.getDelta();
      updateEnemies(delta);
      updateBullets(delta);
    }
    renderer.render(scene, camera);
  }

  function setupUI() {
    document.querySelectorAll('.mapBtn').forEach(btn => {
      btn.onclick = () => {
        const mapIndex = parseInt(btn.dataset.map);
        startGame(mapIndex);
      };
    });

    document.getElementById('resumeBtn').onclick = resumeGame;
    document.getElementById('mainMenuBtn').onclick = () => {
      isPaused = true;
      mainMenu.style.display = 'flex';
      pauseMenu.style.display = 'none';
      healthBarContainer.style.display = 'none';
      clearMap();
      controls.unlock();
    };

    document.addEventListener('mousedown', e => {
      if (!isPaused && e.button === 0) {
        shootBullet();
      }
    });
  }

  init();
  setupUI();
})();
</script>
</body>
</html>
