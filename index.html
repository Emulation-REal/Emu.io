<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Container Yard FPS</title>
<style>
  /* Reset & full screen */
  body, html {
    margin: 0; padding: 0; overflow: hidden;
    background: #111;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #0aff0a;
    user-select: none;
  }
  canvas {
    display: block;
    background: #222;
    margin: 0 auto;
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
  }
  /* Crosshair */
  #crosshair {
    position: fixed;
    top: 50%; left: 50%;
    width: 30px; height: 30px;
    margin-left: -15px; margin-top: -15px;
    pointer-events: none;
    z-index: 10;
  }
  #crosshair div {
    position: absolute;
    background: #0aff0a;
  }
  #crosshair .line {
    width: 2px;
    height: 10px;
    top: 10px;
    left: 14px;
  }
  #crosshair .line.left {
    width: 10px;
    height: 2px;
    top: 14px;
    left: 0;
  }
  #crosshair .line.right {
    width: 10px;
    height: 2px;
    top: 14px;
    right: 0;
  }
  #crosshair .line.top {
    width: 2px;
    height: 10px;
    top: 0;
    left: 14px;
  }
  #crosshair .line.bottom {
    width: 2px;
    height: 10px;
    bottom: 0;
    left: 14px;
  }

  /* Bullet Counter */
  #bulletCounter {
    position: fixed;
    bottom: 20px;
    left: 20px;
    font-size: 24px;
    font-weight: bold;
    text-shadow: 0 0 5px #0aff0a;
    z-index: 10;
  }

  /* Pause & Main Menu overlay */
  #overlay {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.85);
    color: #0aff0a;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 28px;
    z-index: 20;
  }
  #overlay button {
    margin-top: 20px;
    padding: 12px 30px;
    font-size: 20px;
    cursor: pointer;
    border: 2px solid #0aff0a;
    background: transparent;
    color: #0aff0a;
    transition: background 0.3s;
  }
  #overlay button:hover {
    background: #0aff0a;
    color: #111;
  }
</style>
</head>
<body>

<!-- Crosshair -->
<div id="crosshair">
  <div class="line top"></div>
  <div class="line bottom"></div>
  <div class="line left"></div>
  <div class="line right"></div>
</div>

<!-- Bullet Counter -->
<div id="bulletCounter">Bullets: 30</div>

<!-- Overlay for Main Menu / Pause -->
<div id="overlay">
  <div id="menuContent">
    <h1>Container Yard FPS</h1>
    <button id="startBtn">Start Game</button>
  </div>
  <div id="pauseContent" style="display:none;">
    <h2>Paused</h2>
    <button id="resumeBtn">Resume</button>
  </div>
</div>

<!-- Canvas -->
<canvas id="gameCanvas"></canvas>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const overlay = document.getElementById('overlay');
  const menuContent = document.getElementById('menuContent');
  const pauseContent = document.getElementById('pauseContent');
  const startBtn = document.getElementById('startBtn');
  const resumeBtn = document.getElementById('resumeBtn');
  const bulletCounter = document.getElementById('bulletCounter');

  let width, height;
  function resize() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
  }
  window.addEventListener('resize', resize);
  resize();

  // Sounds
  const sounds = {
    shoot: new Audio('https://cdn.pixabay.com/download/audio/2021/12/16/audio_563e67d6db.mp3?filename=gun-shot-10503.mp3'),
    walk: new Audio('https://cdn.pixabay.com/download/audio/2021/08/04/audio_4d109d0342.mp3?filename=footstep-wood-5703.mp3'),
    damage: new Audio('https://cdn.pixabay.com/download/audio/2022/03/25/audio_0e785bc0bb.mp3?filename=pain-789.mp3'),
    mainMenuMusic: new Audio('https://cdn.pixabay.com/download/audio/2022/03/18/audio_f65dffb487.mp3?filename=ambient-future-001.mp3'),
  };

  // Loop main menu music
  sounds.mainMenuMusic.loop = true;

  // Controls
  const keys = {};
  window.addEventListener('keydown', e => {
    if (!e.repeat) keys[e.key.toLowerCase()] = true;
    if(e.key === 'Escape' && gameStarted){
      togglePause();
    }
  });
  window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

  // Game variables
  let gameStarted = false;
  let gamePaused = false;

  // Player setup
  const player = {
    x: width / 2,
    y: height / 2,
    width: 30,
    height: 40,
    speed: 3.5,
    bullets: 30,
    maxBullets: 30,
    reloadTime: 1500,
    reloading: false,
    health: 100,
    color: '#0aff0a',
    gun: {
      width: 50,
      height: 12,
      barrelLength: 30,
      color: '#00cc00'
    }
  };

  // Container yard style map (top down rectangles)
  const containers = [
    {x: 120, y: 100, w: 180, h: 80, color: '#6b4f4f'},
    {x: 320, y: 100, w: 220, h: 120, color: '#735c5c'},
    {x: 580, y: 100, w: 150, h: 130, color: '#815e5e'},
    {x: 180, y: 250, w: 250, h: 100, color: '#634343'},
    {x: 510, y: 280, w: 210, h: 110, color: '#754747'},
    {x: 780, y: 170, w: 160, h: 140, color: '#644343'},
    {x: 950, y: 310, w: 110, h: 60, color: '#6f4a4a'},
  ];

  // Enemy setup
  class Enemy {
    constructor(x,y) {
      this.x = x;
      this.y = y;
      this.width = 30;
      this.height = 40;
      this.color = '#ff3300';
      this.speed = 1.7;
      this.health = 50;
      this.reloadTime = 2000;
      this.canShoot = true;
    }
    moveToward(px, py) {
      const dx = px - this.x;
      const dy = py - this.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist > 50) { // stop if close to player
        this.x += (dx/dist) * this.speed;
        this.y += (dy/dist) * this.speed;
      }
    }
    shoot(px, py) {
      if (this.canShoot) {
        this.canShoot = false;
        // Create bullet
        bullets.push(new Bullet(this.x + this.width/2, this.y + this.height/2, px, py, 'enemy'));
        setTimeout(() => { this.canShoot = true; }, this.reloadTime);
      }
    }
    draw(ctx) {
      // Body
      ctx.fillStyle = this.color;
      ctx.fillRect(this.x, this.y, this.width, this.height);
      // Gun
      ctx.fillStyle = '#cc2200';
      ctx.fillRect(this.x + this.width - 8, this.y + this.height/2 - 6, 30, 12);
      ctx.fillRect(this.x + this.width + 22, this.y + this.height/2 - 2, 15, 4);
    }
  }

  // Bullet setup
  class Bullet {
    constructor(x, y, targetX, targetY, owner='player') {
      this.x = x;
      this.y = y;
      this.radius = 5;
      this.speed = 8;
      this.owner = owner;
      // direction vector normalized
      const dx = targetX - x;
      const dy = targetY - y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      this.velX = (dx/dist) * this.speed;
      this.velY = (dy/dist) * this.speed;
    }
    update() {
      this.x += this.velX;
      this.y += this.velY;
    }
    draw(ctx) {
      ctx.fillStyle = this.owner === 'player' ? '#0aff0a' : '#ff3300';
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
      ctx.fill();
    }
  }

  // Game objects
  const enemies = [];
  const bullets = [];

  // Spawn some enemies in fixed spots
  function spawnEnemies() {
    enemies.length = 0;
    enemies.push(new Enemy(200, 150));
    enemies.push(new Enemy(400, 300));
    enemies.push(new Enemy(700, 220));
    enemies.push(new Enemy(850, 350));
  }

  // Update bullet counter UI
  function updateBulletCounter() {
    bulletCounter.textContent = `Bullets: ${player.bullets}`;
  }

  // Check rectangle collision helper
  function rectIntersect(x1,y1,w1,h1, x2,y2,w2,h2) {
    return !(x2 > x1+w1 || x2+w2 < x1 || y2 > y1+h1 || y2+h2 < y1);
  }

  // Game loop
  function gameLoop() {
    if (gamePaused || !gameStarted) return;

    // Clear
    ctx.clearRect(0, 0, width, height);

    // Draw map containers
    containers.forEach(c => {
      ctx.fillStyle = c.color;
      ctx.fillRect(c.x, c.y, c.w, c.h);
      ctx.strokeStyle = '#331111';
      ctx.lineWidth = 4;
      ctx.strokeRect(c.x, c.y, c.w, c.h);
    });

    // Player movement with WASD or arrows
    let moved = false;
    if ((keys['w'] || keys['arrowup'])) {
      player.y -= player.speed;
      moved = true;
    }
    if ((keys['s'] || keys['arrowdown'])) {
      player.y += player.speed;
      moved = true;
    }
    if ((keys['a'] || keys['arrowleft'])) {
      player.x -= player.speed;
      moved = true;
    }
    if ((keys['d'] || keys['arrowright'])) {
      player.x += player.speed;
      moved = true;
    }

    // Clamp player inside screen
    player.x = Math.max(0, Math.min(width - player.width, player.x));
    player.y = Math.max(0, Math.min(height - player.height, player.y));

    // Play walking sound if moved
    if (moved) {
      if (sounds.walk.paused) {
        sounds.walk.currentTime = 0;
        sounds.walk.play();
      }
    } else {
      sounds.walk.pause();
    }

    // Draw player body
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Draw player gun
    ctx.fillStyle = player.gun.color;
    ctx.fillRect(player.x + player.width - 10, player.y + player.height/2 - 6, player.gun.width, player.gun.height);
    ctx.fillRect(player.x + player.width - 10 + player.gun.width, player.y + player.height/2 - 4, player.gun.barrelLength, 8);

    // Update & draw bullets
    for (let i = bullets.length - 1; i >= 0; i--) {
      const b = bullets[i];
      b.update();
      b.draw(ctx);

      // Remove bullet if offscreen
      if (b.x < 0 || b.x > width || b.y < 0 || b.y > height) {
        bullets.splice(i, 1);
        continue;
      }

      // Collision checks
      if (b.owner === 'player') {
        // Check collision with enemies
        for (let j = enemies.length - 1; j >= 0; j--) {
          const e = enemies[j];
          if (rectIntersect(b.x - b.radius, b.y - b.radius, b.radius*2, b.radius*2, e.x, e.y, e.width, e.height)) {
            enemies.splice(j, 1);
            bullets.splice(i,1);
            break;
          }
        }
      } else {
        // Bullet from enemy hits player
        if (rectIntersect(b.x - b.radius, b.y - b.radius, b.radius*2, b.radius*2, player.x, player.y, player.width, player.height)) {
          bullets.splice(i, 1);
          player.health -= 10;
          sounds.damage.currentTime = 0;
          sounds.damage.play();
          if (player.health <= 0) {
            alert("You died! Refresh to play again.");
            gamePaused = true;
            overlay.style.display = 'flex';
            menuContent.style.display = 'block';
            pauseContent.style.display = 'none';
            gameStarted = false;
          }
        }
      }
    }

    // Enemy AI: move towards player and shoot randomly if close
    enemies.forEach(enemy => {
      enemy.moveToward(player.x, player.y);
      // Check line of sight & distance
      const dx = player.x - enemy.x;
      const dy = player.y - enemy.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist < 300) {
        if (Math.random() < 0.01) {
          enemy.shoot(player.x + player.width/2, player.y + player.height/2);
        }
      }
      enemy.draw(ctx);
    });

    updateBulletCounter();

    requestAnimationFrame(gameLoop);
  }

  // Shoot player bullets on mouse click
  window.addEventListener('mousedown', e => {
    if (!gameStarted || gamePaused) return;
    if (player.reloading) return;

    if (player.bullets > 0) {
      const mouseX = e.clientX;
      const mouseY = e.clientY;
      player.bullets--;
      bullets.push(new Bullet(player.x + player.width, player.y + player.height / 2, mouseX, mouseY, 'player'));
      sounds.shoot.currentTime = 0;
      sounds.shoot.play();
      updateBulletCounter();
    } else {
      reloadGun();
    }
  });

  // Reload function
  function reloadGun() {
    if (player.reloading) return;
    player.reloading = true;
    setTimeout(() => {
      player.bullets = player.maxBullets;
      player.reloading = false;
      updateBulletCounter();
    }, player.reloadTime);
  }

  // Main menu start button
  startBtn.addEventListener('click', () => {
    overlay.style.display = 'none';
    menuContent.style.display = 'none';
    pauseContent.style.display = 'none';
    gameStarted = true;
    gamePaused = false;
    player.health = 100;
    player.bullets = player.maxBullets;
    player.x = width/2;
    player.y = height/2;
    bullets.length = 0;
    spawnEnemies();
    updateBulletCounter();
    sounds.mainMenuMusic.pause();
    gameLoop();
  });

  // Pause menu resume button
  resumeBtn.addEventListener('click', () => {
    overlay.style.display = 'none';
    pauseContent.style.display = 'none';
    gamePaused = false;
    gameLoop();
  });

  // Pause toggle
  function togglePause() {
    if (!gameStarted) return;
    gamePaused = !gamePaused;
    if (gamePaused) {
      overlay.style.display = 'flex';
      pauseContent.style.display = 'block';
      menuContent.style.display = 'none';
      sounds.walk.pause();
    } else {
      overlay.style.display = 'none';
      pauseContent.style.display = 'none';
      sounds.walk.currentTime = 0;
      sounds.walk.play();
      gameLoop();
    }
  }

  // Play main menu music on load
  window.onload = () => {
    sounds.mainMenuMusic.volume = 0.3;
    sounds.mainMenuMusic.play();
  };
})();
</script>
</body>
</html>
