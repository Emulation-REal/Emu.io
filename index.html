<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Airsoft Field FPS</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      background: #111;
    }
    canvas {
      display: block;
    }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 5;
      color: white;
      font-size: 18px;
      user-select: none;
      font-family: Arial, sans-serif;
    }
    #crosshair {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 4px;
      height: 4px;
      background: white;
      transform: translate(-50%, -50%);
      z-index: 5;
    }
  </style>
</head>
<body>
  <div id="hud">
    <div>Health: <span id="healthText">100</span></div>
    <div>Ammo: <span id="ammoText">10 / 10</span></div>
  </div>
  <div id="crosshair"></div>
  <canvas id="gameCanvas"></canvas>

  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.module.js';
    import { PointerLockControls } from 'https://cdn.jsdelivr.net/npm/three@0.153.0/examples/jsm/controls/PointerLockControls.js';

    const canvas = document.getElementById('gameCanvas');
    const healthText = document.getElementById('healthText');
    const ammoText = document.getElementById('ammoText');

    let scene, camera, renderer, controls, clock;
    let bullets = [], enemies = [];
    let health = 100, ammo = 10, maxAmmo = 10;
    let playerSpeed = 5;
    let keys = {};
    let lastShotTime = 0;

    init();
    animate();

    function init() {
      scene = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 1.6, 0);

      renderer = new THREE.WebGLRenderer({ canvas });
      renderer.setSize(window.innerWidth, window.innerHeight);
      clock = new THREE.Clock();

      const ambient = new THREE.AmbientLight(0xffffff, 0.4);
      const dir = new THREE.DirectionalLight(0xffffff, 1);
      dir.position.set(50, 100, 50);
      scene.add(ambient, dir);

      const floor = new THREE.Mesh(
        new THREE.PlaneGeometry(500, 500),
        new THREE.MeshStandardMaterial({ color: 0x444444 })
      );
      floor.rotation.x = -Math.PI / 2;
      scene.add(floor);

      // Add cover objects
      const houseMat = new THREE.MeshStandardMaterial({ color: 0x888888 });
      for (let i = 0; i < 10; i++) {
        const house = new THREE.Mesh(new THREE.BoxGeometry(8, 5, 8), houseMat);
        house.position.set((Math.random() - 0.5) * 400, 2.5, (Math.random() - 0.5) * 400);
        scene.add(house);
      }

      const barrierMat = new THREE.MeshStandardMaterial({ color: 0x5555aa });
      for (let i = 0; i < 30; i++) {
        const barrier = new THREE.Mesh(new THREE.BoxGeometry(2, 2, 6), barrierMat);
        barrier.position.set((Math.random() - 0.5) * 400, 1, (Math.random() - 0.5) * 400);
        scene.add(barrier);
      }

      controls = new PointerLockControls(camera, document.body);
      scene.add(controls.getObject());

      canvas.addEventListener('click', () => {
        canvas.requestPointerLock();
      });

      document.addEventListener('pointerlockchange', () => {
        if (document.pointerLockElement === canvas) {
          controls.lock();
        }
      });

      window.addEventListener('keydown', e => keys[e.code] = true);
      window.addEventListener('keyup', e => keys[e.code] = false);

      document.addEventListener('mousedown', shoot);

      for (let i = 0; i < 5; i++) spawnEnemy();
    }

    function shoot() {
      if (ammo <= 0) return;
      const now = performance.now();
      if (now - lastShotTime < 300) return;
      lastShotTime = now;
      ammo--;
      ammoText.textContent = `${ammo} / ${maxAmmo}`;

      const bullet = new THREE.Mesh(
        new THREE.SphereGeometry(0.1),
        new THREE.MeshStandardMaterial({ color: 0xffff00 })
      );
      bullet.position.copy(camera.position);
      const dir = new THREE.Vector3();
      camera.getWorldDirection(dir);
      bullet.userData.velocity = dir.multiplyScalar(2);
      scene.add(bullet);
      bullets.push(bullet);
    }

    function spawnEnemy() {
      const enemy = new THREE.Mesh(
        new THREE.BoxGeometry(1, 2, 1),
        new THREE.MeshStandardMaterial({ color: 0xff0000 })
      );
      enemy.position.set((Math.random() - 0.5) * 400, 1, (Math.random() - 0.5) * 400);
      enemy.health = 100;
      scene.add(enemy);
      enemies.push(enemy);
    }

    function animate() {
      requestAnimationFrame(animate);
      const delta = clock.getDelta();

      bullets.forEach((b, i) => {
        b.position.add(b.userData.velocity);
        if (b.position.length() > 200) {
          scene.remove(b);
          bullets.splice(i, 1);
        }
      });

      enemies.forEach((enemy, i) => {
        const dir = new THREE.Vector3().subVectors(camera.position, enemy.position);
        if (dir.length() < 50) {
          dir.normalize().multiplyScalar(0.02);
          enemy.position.add(dir);
          if (Math.random() < 0.005) {
            health -= 5;
            healthText.textContent = health;
            if (health <= 0) respawn();
          }
        }
        bullets.forEach((b, j) => {
          if (b.position.distanceTo(enemy.position) < 1) {
            enemy.health -= 50;
            scene.remove(b);
            bullets.splice(j, 1);
            if (enemy.health <= 0) {
              scene.remove(enemy);
              enemies.splice(i, 1);
              setTimeout(spawnEnemy, 3000);
            }
          }
        });
      });

      const speed = playerSpeed * delta;
      if (keys['KeyW']) controls.moveForward(speed);
      if (keys['KeyS']) controls.moveForward(-speed);
      if (keys['KeyA']) controls.moveRight(-speed);
      if (keys['KeyD']) controls.moveRight(speed);

      renderer.render(scene, camera);
    }

    function respawn() {
      health = 100;
      healthText.textContent = health;
      camera.position.set(0, 1.6, 0);
    }
  </script>
</body>
</html>
